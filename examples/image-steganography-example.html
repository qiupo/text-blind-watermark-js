<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å›¾åƒéšå†™æœ¯ç¤ºä¾‹ - Text Blind Watermark JS</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
        }
        
        .container {
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            margin-bottom: 20px;
        }
        
        h1 {
            color: #333;
            text-align: center;
            margin-bottom: 30px;
        }
        
        h2 {
            color: #555;
            border-bottom: 2px solid #007bff;
            padding-bottom: 10px;
        }
        
        .section {
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #555;
        }
        
        input[type="file"], input[type="text"], input[type="password"], textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 14px;
            box-sizing: border-box;
        }
        
        textarea {
            height: 100px;
            resize: vertical;
        }
        
        button {
            background-color: #007bff;
            color: white;
            padding: 12px 24px;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
            margin-right: 10px;
            margin-bottom: 10px;
        }
        
        button:hover {
            background-color: #0056b3;
        }
        
        button:disabled {
            background-color: #ccc;
            cursor: not-allowed;
        }
        
        .success {
            color: #28a745;
            font-weight: bold;
        }
        
        .error {
            color: #dc3545;
            font-weight: bold;
        }
        
        .info {
            background-color: #e7f3ff;
            border: 1px solid #b3d9ff;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }
        
        .image-preview {
            max-width: 100%;
            max-height: 300px;
            border: 1px solid #ddd;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .stats {
            background-color: #f8f9fa;
            padding: 15px;
            border-radius: 5px;
            margin: 10px 0;
        }
        
        .checkbox-group {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }
        
        .checkbox-group input[type="checkbox"] {
            width: auto;
            margin-right: 10px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>ğŸ–¼ï¸ å›¾åƒéšå†™æœ¯ç¤ºä¾‹</h1>
        
        <div class="info">
            <strong>åŠŸèƒ½è¯´æ˜ï¼š</strong>ä½¿ç”¨LSBï¼ˆæœ€ä½æœ‰æ•ˆä½ï¼‰éšå†™æœ¯æŠ€æœ¯ï¼Œå°†æ–‡æœ¬ä¿¡æ¯éšè—åœ¨å›¾åƒçš„åƒç´ ä¸­ã€‚
            æ”¯æŒåŠ å¯†ã€æ•°æ®å®Œæ•´æ€§æ ¡éªŒç­‰é«˜çº§åŠŸèƒ½ã€‚
        </div>

        <!-- éšè—æ•°æ®éƒ¨åˆ† -->
        <div class="section">
            <h2>ğŸ“ éšè—æ•°æ®åˆ°å›¾åƒ</h2>
            
            <div class="form-group">
                <label for="sourceImage">é€‰æ‹©æºå›¾åƒï¼š</label>
                <input type="file" id="sourceImage" accept="image/*">
            </div>
            
            <div class="form-group">
                <label for="messageToHide">è¦éšè—çš„æ–‡æœ¬ï¼š</label>
                <textarea id="messageToHide" placeholder="è¾“å…¥è¦éšè—çš„æ–‡æœ¬ä¿¡æ¯..."></textarea>
            </div>
            
            <div class="form-group">
                <label for="hidePassword">åŠ å¯†å¯†ç ï¼ˆå¯é€‰ï¼‰ï¼š</label>
                <input type="password" id="hidePassword" placeholder="è¾“å…¥å¯†ç ä»¥åŠ å¯†éšè—çš„æ•°æ®">
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="enableChecksum" checked>
                <label for="enableChecksum">å¯ç”¨æ•°æ®å®Œæ•´æ€§æ ¡éªŒ</label>
            </div>
            
            <button onclick="hideMessage()">éšè—æ•°æ®</button>
            <button onclick="downloadHiddenImage()" id="downloadBtn" disabled>ä¸‹è½½éšè—å›¾åƒ</button>
            
            <div id="hideResult"></div>
            <div id="imageStats"></div>
            <canvas id="hiddenCanvas" style="display: none;"></canvas>
        </div>

        <!-- æå–æ•°æ®éƒ¨åˆ† -->
        <div class="section">
            <h2>ğŸ” ä»å›¾åƒä¸­æå–æ•°æ®</h2>
            
            <div class="form-group">
                <label for="hiddenImage">é€‰æ‹©åŒ…å«éšè—æ•°æ®çš„å›¾åƒï¼š</label>
                <input type="file" id="hiddenImage" accept="image/*">
            </div>
            
            <div class="form-group">
                <label for="extractPassword">è§£å¯†å¯†ç ï¼ˆå¦‚æœæœ‰ï¼‰ï¼š</label>
                <input type="password" id="extractPassword" placeholder="è¾“å…¥è§£å¯†å¯†ç ">
            </div>
            
            <div class="checkbox-group">
                <input type="checkbox" id="extractChecksum" checked>
                <label for="extractChecksum">éªŒè¯æ•°æ®å®Œæ•´æ€§</label>
            </div>
            
            <button onclick="extractMessage()">æå–æ•°æ®</button>
            <button onclick="checkHiddenData()">æ£€æŸ¥æ˜¯å¦åŒ…å«éšè—æ•°æ®</button>
            
            <div id="extractResult"></div>
            
            <div class="form-group" style="margin-top: 20px;">
                <label for="extractedMessage">æå–çš„æ–‡æœ¬ï¼š</label>
                <textarea id="extractedMessage" readonly></textarea>
            </div>
        </div>
    </div>

    <!-- å¼•å…¥crypto-jsä¾èµ– -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/crypto-js/4.1.1/crypto-js.min.js"></script>
    <!-- å¼•å…¥å›¾åƒéšå†™æœ¯æ¨¡å— -->
    <script src="../dist/image-steganography.umd.js"></script>
    <script>
        const { ImageSteganography, CanvasImageProcessor } = window.ImageSteganography;
        
        let hiddenImageData = null;
        let steganography = null;

        // å…¨å±€å‡½æ•°
        window.hideMessage = async function() {
            try {
                const fileInput = document.getElementById('sourceImage');
                const message = document.getElementById('messageToHide').value;
                const password = document.getElementById('hidePassword').value;
                const enableChecksum = document.getElementById('enableChecksum').checked;
                
                if (!fileInput.files[0]) {
                    showResult('hideResult', 'è¯·é€‰æ‹©æºå›¾åƒæ–‡ä»¶', 'error');
                    return;
                }
                
                if (!message.trim()) {
                    showResult('hideResult', 'è¯·è¾“å…¥è¦éšè—çš„æ–‡æœ¬', 'error');
                    return;
                }
                
                showResult('hideResult', 'æ­£åœ¨å¤„ç†å›¾åƒ...', 'info');
                
                // åˆ›å»ºéšå†™æœ¯å®ä¾‹
                steganography = new ImageSteganography({
                    password: password || undefined,
                    checksum: enableChecksum
                });
                
                // åŠ è½½å›¾åƒ
                const imageData = await CanvasImageProcessor.loadImageFromFile(fileInput.files[0]);
                
                // æ˜¾ç¤ºå›¾åƒç»Ÿè®¡ä¿¡æ¯
                const maxCapacity = steganography.getMaxCapacity(imageData);
                const messageSize = new TextEncoder().encode(message).length;
                
                document.getElementById('imageStats').innerHTML = `
                    <div class="stats">
                        <strong>å›¾åƒä¿¡æ¯ï¼š</strong><br>
                        å°ºå¯¸: ${imageData.width} Ã— ${imageData.height}<br>
                        æœ€å¤§å®¹é‡: ${maxCapacity} å­—èŠ‚<br>
                        æ¶ˆæ¯å¤§å°: ${messageSize} å­—èŠ‚<br>
                        å®¹é‡ä½¿ç”¨ç‡: ${(messageSize / maxCapacity * 100).toFixed(2)}%
                    </div>
                `;
                
                // éšè—æ•°æ®
                hiddenImageData = steganography.hideData(imageData, message);
                
                // æ˜¾ç¤ºç»“æœ
                showResult('hideResult', 'æ•°æ®éšè—æˆåŠŸï¼', 'success');
                document.getElementById('downloadBtn').disabled = false;
                
            } catch (error) {
                showResult('hideResult', `é”™è¯¯: ${error.message}`, 'error');
                console.error(error);
            }
        };

        window.downloadHiddenImage = function() {
            if (hiddenImageData) {
                CanvasImageProcessor.downloadImage(hiddenImageData, 'hidden-image.png');
            }
        };

        window.extractMessage = async function() {
            try {
                const fileInput = document.getElementById('hiddenImage');
                const password = document.getElementById('extractPassword').value;
                const enableChecksum = document.getElementById('extractChecksum').checked;
                
                if (!fileInput.files[0]) {
                    showResult('extractResult', 'è¯·é€‰æ‹©åŒ…å«éšè—æ•°æ®çš„å›¾åƒæ–‡ä»¶', 'error');
                    return;
                }
                
                showResult('extractResult', 'æ­£åœ¨æå–æ•°æ®...', 'info');
                
                // åˆ›å»ºéšå†™æœ¯å®ä¾‹
                const extractSteganography = new ImageSteganography({
                    password: password || undefined,
                    checksum: enableChecksum
                });
                
                // åŠ è½½å›¾åƒ
                const imageData = await CanvasImageProcessor.loadImageFromFile(fileInput.files[0]);
                
                // æå–æ•°æ®
                const extractedMessage = extractSteganography.extractData(imageData);
                
                // æ˜¾ç¤ºç»“æœ
                document.getElementById('extractedMessage').value = extractedMessage;
                showResult('extractResult', 'æ•°æ®æå–æˆåŠŸï¼', 'success');
                
            } catch (error) {
                showResult('extractResult', `é”™è¯¯: ${error.message}`, 'error');
                document.getElementById('extractedMessage').value = '';
                console.error(error);
            }
        };

        window.checkHiddenData = async function() {
            try {
                const fileInput = document.getElementById('hiddenImage');
                
                if (!fileInput.files[0]) {
                    showResult('extractResult', 'è¯·é€‰æ‹©å›¾åƒæ–‡ä»¶', 'error');
                    return;
                }
                
                // åˆ›å»ºéšå†™æœ¯å®ä¾‹
                const checkSteganography = new ImageSteganography();
                
                // åŠ è½½å›¾åƒ
                const imageData = await CanvasImageProcessor.loadImageFromFile(fileInput.files[0]);
                
                // æ£€æŸ¥æ˜¯å¦åŒ…å«éšè—æ•°æ®
                const hasHidden = checkSteganography.hasHiddenData(imageData);
                
                if (hasHidden) {
                    showResult('extractResult', 'âœ… å›¾åƒåŒ…å«éšè—æ•°æ®', 'success');
                } else {
                    showResult('extractResult', 'âŒ å›¾åƒä¸åŒ…å«éšè—æ•°æ®', 'info');
                }
                
            } catch (error) {
                showResult('extractResult', `é”™è¯¯: ${error.message}`, 'error');
                console.error(error);
            }
        };

        function showResult(elementId, message, type) {
            const element = document.getElementById(elementId);
            element.innerHTML = `<div class="${type}">${message}</div>`;
        }

        // æ–‡ä»¶é€‰æ‹©é¢„è§ˆ
        document.getElementById('sourceImage').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.createElement('img');
                    preview.src = e.target.result;
                    preview.className = 'image-preview';
                    
                    const existing = document.querySelector('#sourceImage + .image-preview');
                    if (existing) existing.remove();
                    
                    e.target.parentNode.insertBefore(preview, e.target.nextSibling);
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });

        document.getElementById('hiddenImage').addEventListener('change', function(e) {
            if (e.target.files[0]) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const preview = document.createElement('img');
                    preview.src = e.target.result;
                    preview.className = 'image-preview';
                    
                    const existing = document.querySelector('#hiddenImage + .image-preview');
                    if (existing) existing.remove();
                    
                    e.target.parentNode.insertBefore(preview, e.target.nextSibling);
                };
                reader.readAsDataURL(e.target.files[0]);
            }
        });
    </script>
</body>
</html>