<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–‡æœ¬ç›²æ°´å° JS - æµè§ˆå™¨ç¤ºä¾‹</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
            line-height: 1.6;
        }
        .container {
            background: #f5f5f5;
            padding: 20px;
            border-radius: 8px;
            margin: 20px 0;
        }
        textarea {
            width: 100%;
            min-height: 100px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-family: monospace;
            resize: vertical;
        }
        input[type="text"], input[type="password"] {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin: 5px 0;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
        .result {
            background: #e8f5e8;
            border: 1px solid #4caf50;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .error {
            background: #ffe8e8;
            border: 1px solid #f44336;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .info {
            background: #e3f2fd;
            border: 1px solid #2196f3;
            padding: 10px;
            border-radius: 4px;
            margin: 10px 0;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <h1>ğŸ”’ æ–‡æœ¬ç›²æ°´å° JS - æµè§ˆå™¨æ¼”ç¤º</h1>
    
    <div class="info">
        <strong>å·¥ä½œåŸç†ï¼š</strong> è¯¥åº“ä½¿ç”¨é›¶å®½åº¦ Unicode å­—ç¬¦åœ¨æ–‡æœ¬ä¸­åµŒå…¥ä¸å¯è§çš„æ°´å°ã€‚
        åŠ æ°´å°çš„æ–‡æœ¬çœ‹èµ·æ¥ä¸åŸæ–‡å®Œå…¨ç›¸åŒï¼Œä½†åŒ…å«å¯ä»¥ç”¨æ­£ç¡®å¯†ç æå–çš„éšè—ä¿¡æ¯ã€‚
    </div>

    <div class="container">
        <h2>ğŸ” é…ç½®</h2>
        <label for="password">å¯†ç ï¼š</label>
        <input type="password" id="password" placeholder="è¾“å…¥æ‚¨çš„ç§˜å¯†å¯†ç " value="demo-password">
        
        <label for="seed">éšæœºç§å­ï¼ˆå¯é€‰ï¼‰ï¼š</label>
        <input type="text" id="seed" placeholder="ç•™ç©ºè¡¨ç¤ºéšæœºæ”¾ç½®">
    </div>

    <div class="container">
        <h2>ğŸ“ æ·»åŠ æ°´å°</h2>
        <label for="originalText">åŸå§‹æ–‡æœ¬ï¼š</label>
        <textarea id="originalText" placeholder="è¾“å…¥æ‚¨è¦æ·»åŠ æ°´å°çš„æ–‡æœ¬...">è¿™æ˜¯ä¸€ä¸ªå°†è¢«æ·»åŠ æ°´å°çš„ç¤ºä¾‹æ–‡æœ¬ã€‚æ°´å°å¯¹äººçœ¼æ¥è¯´æ˜¯å®Œå…¨ä¸å¯è§çš„ï¼Œä½†å¯ä»¥é€šè¿‡æ­£ç¡®çš„å¯†ç ä»¥ç¼–ç¨‹æ–¹å¼æå–ã€‚æ‚¨å¯ä»¥å°†æ­¤æ–‡æœ¬å¤åˆ¶ç²˜è´´åˆ°ä»»ä½•åœ°æ–¹ï¼Œæ°´å°éƒ½ä¼šä¿æŒå®Œæ•´ï¼</textarea>
        
        <label for="secretMessage">ç§˜å¯†æ¶ˆæ¯ï¼š</label>
        <input type="text" id="secretMessage" placeholder="è¾“å…¥æ‚¨çš„ç§˜å¯†æ¶ˆæ¯..." value="è¿™æ˜¯ä¸€ä¸ªéšè—çš„æ°´å°ï¼">
        
        <button onclick="addWatermark()">ğŸ”’ æ·»åŠ æ°´å°</button>
        
        <div id="watermarkResult" class="hidden">
            <h3>åŠ æ°´å°çš„æ–‡æœ¬ï¼š</h3>
            <textarea id="watermarkedText" readonly></textarea>
            <div class="info">
                <strong>æˆåŠŸï¼</strong> ä¸Šé¢çš„æ–‡æœ¬åŒ…å«æ‚¨çš„éšè—æ°´å°ã€‚
                å¤åˆ¶å®ƒå¹¶åœ¨ä¸‹é¢å°è¯•æå–æ°´å°ã€‚
            </div>
        </div>
    </div>

    <div class="container">
        <h2>ğŸ” æå–æ°´å°</h2>
        <label for="textToExtract">å¸¦æ°´å°çš„æ–‡æœ¬ï¼š</label>
        <textarea id="textToExtract" placeholder="åœ¨æ­¤ç²˜è´´å¸¦æ°´å°çš„æ–‡æœ¬..."></textarea>
        
        <button onclick="extractWatermark()">ğŸ”“ æå–æ°´å°</button>
        <button onclick="checkWatermark()">ğŸ” æ£€æŸ¥æ˜¯å¦æœ‰æ°´å°</button>
        <button onclick="removeWatermark()">ğŸ§¹ ç§»é™¤æ°´å°</button>
        
        <div id="extractResult" class="hidden"></div>
    </div>

    <div class="container">
        <h2>ğŸ§ª æµ‹è¯•ç”¨ä¾‹</h2>
        <button onclick="testUnicode()">æµ‹è¯• Unicode æ”¯æŒ</button>
        <button onclick="testSecurity()">æµ‹è¯•å®‰å…¨æ€§</button>
        <button onclick="testEdgeCases()">æµ‹è¯•è¾¹ç•Œæƒ…å†µ</button>
        
        <div id="testResults"></div>
    </div>

    <!-- Load the library from CDN or local build -->
    <script src="../dist/index.umd.js"></script>
    
    <script>
        // å…¨å±€æ°´å°å®ä¾‹
        let watermark = null;

        function updateWatermark() {
            const password = document.getElementById('password').value || 'default_password';
            const seedInput = document.getElementById('seed').value;
            const seed = seedInput ? parseInt(seedInput) : undefined;
            
            watermark = new TextBlindWatermark.TextBlindWatermark({ password, seed });
        }

        function addWatermark() {
            updateWatermark();
            
            const originalText = document.getElementById('originalText').value;
            const secretMessage = document.getElementById('secretMessage').value;
            
            if (!originalText || !secretMessage) {
                showError('è¯·è¾“å…¥åŸå§‹æ–‡æœ¬å’Œç§˜å¯†æ¶ˆæ¯ã€‚');
                return;
            }
            
            try {
                const watermarkedText = watermark.addWatermarkRandom(originalText, secretMessage);
                
                document.getElementById('watermarkedText').value = watermarkedText;
                document.getElementById('watermarkResult').classList.remove('hidden');
                
                // è‡ªåŠ¨å¡«å……æå–å­—æ®µ
                document.getElementById('textToExtract').value = watermarkedText;
                
            } catch (error) {
                showError('æ·»åŠ æ°´å°å¤±è´¥ï¼š' + error.message);
            }
        }

        function extractWatermark() {
            updateWatermark();
            
            const textToExtract = document.getElementById('textToExtract').value;
            
            if (!textToExtract) {
                showError('è¯·è¾“å…¥è¦æå–æ°´å°çš„æ–‡æœ¬ã€‚');
                return;
            }
            
            try {
                const extractedMessage = watermark.extractAsString(textToExtract);
                showResult('æå–çš„æ°´å°ï¼š' + extractedMessage);
            } catch (error) {
                showError('æå–æ°´å°å¤±è´¥ï¼š' + error.message);
            }
        }

        function checkWatermark() {
            updateWatermark();
            
            const textToCheck = document.getElementById('textToExtract').value;
            
            if (!textToCheck) {
                showError('è¯·è¾“å…¥è¦æ£€æŸ¥çš„æ–‡æœ¬ã€‚');
                return;
            }
            
            try {
                const hasWatermark = watermark.hasWatermark(textToCheck);
                showResult('åŒ…å«æ°´å°ï¼š' + (hasWatermark ? 'æ˜¯ âœ…' : 'å¦ âŒ'));
            } catch (error) {
                showError('æ£€æŸ¥æ°´å°å¤±è´¥ï¼š' + error.message);
            }
        }

        function removeWatermark() {
            updateWatermark();
            
            const textToClean = document.getElementById('textToExtract').value;
            
            if (!textToClean) {
                showError('è¯·è¾“å…¥è¦æ¸…ç†çš„æ–‡æœ¬ã€‚');
                return;
            }
            
            try {
                const cleanText = watermark.removeWatermark(textToClean);
                showResult('æ¸…ç†åçš„æ–‡æœ¬ï¼š' + cleanText);
            } catch (error) {
                showError('ç§»é™¤æ°´å°å¤±è´¥ï¼š' + error.message);
            }
        }

        function testUnicode() {
            updateWatermark();
            
            const testCases = [
                { text: 'è¿™æ˜¯ä¸­æ–‡æµ‹è¯•æ–‡æœ¬', secret: 'ä¸­æ–‡æ°´å°' },
                { text: 'Text with emojis ğŸ‰ğŸš€â­', secret: 'Emoji test! ğŸ”’' },
                { text: 'Ø§Ù„Ø¹Ø±Ø¨ÙŠØ© Ø§Ù„Ù†Øµ', secret: 'Arabic watermark' }
            ];
            
            let results = '<h3>Unicode æµ‹è¯•ç»“æœï¼š</h3>';
            
            testCases.forEach((testCase, index) => {
                try {
                    const watermarked = watermark.addWatermarkRandom(testCase.text, testCase.secret);
                    const extracted = watermark.extractAsString(watermarked);
                    const success = extracted === testCase.secret;
                    
                    results += `<div class="${success ? 'result' : 'error'}">
                        æµ‹è¯• ${index + 1}: ${success ? 'âœ…' : 'âŒ'}<br>
                        åŸæ–‡: ${testCase.text}<br>
                        ç§˜å¯†: ${testCase.secret}<br>
                        æå–ç»“æœ: ${extracted}
                    </div>`;
                } catch (error) {
                    results += `<div class="error">æµ‹è¯• ${index + 1}: âŒ é”™è¯¯: ${error.message}</div>`;
                }
            });
            
            document.getElementById('testResults').innerHTML = results;
        }

        function testSecurity() {
            const correctPassword = 'correct-password';
            const wrongPassword = 'wrong-password';
            
            const correctWatermark = new TextBlindWatermark.TextBlindWatermark({ password: correctPassword });
            const wrongWatermark = new TextBlindWatermark.TextBlindWatermark({ password: wrongPassword });
            
            const text = 'ç”¨äºå¯†ç ä¿æŠ¤çš„å®‰å…¨æµ‹è¯•æ–‡æœ¬ã€‚';
            const secret = 'ç§˜å¯†æ¶ˆæ¯';
            
            let results = '<h3>å®‰å…¨æµ‹è¯•ç»“æœï¼š</h3>';
            
            try {
                // ä½¿ç”¨æ­£ç¡®å¯†ç æ·»åŠ æ°´å°
                const watermarked = correctWatermark.addWatermarkRandom(text, secret);
                
                // å°è¯•ä½¿ç”¨æ­£ç¡®å¯†ç æå–
                const correctExtraction = correctWatermark.extractAsString(watermarked);
                const correctSuccess = correctExtraction === secret;
                
                results += `<div class="${correctSuccess ? 'result' : 'error'}">
                    æ­£ç¡®å¯†ç : ${correctSuccess ? 'âœ…' : 'âŒ'}<br>
                    æå–ç»“æœ: ${correctExtraction}
                </div>`;
                
                // å°è¯•ä½¿ç”¨é”™è¯¯å¯†ç æå–
                try {
                    const wrongExtraction = wrongWatermark.extractAsString(watermarked);
                    results += `<div class="error">
                        é”™è¯¯å¯†ç : âŒ åº”è¯¥å¤±è´¥ä½†å¾—åˆ°äº†: ${wrongExtraction}
                    </div>`;
                } catch (error) {
                    results += `<div class="result">
                        é”™è¯¯å¯†ç : âœ… æ­£ç¡®å¤±è´¥ï¼Œé”™è¯¯ä¿¡æ¯: ${error.message}
                    </div>`;
                }
                
            } catch (error) {
                results += `<div class="error">å®‰å…¨æµ‹è¯•å¤±è´¥: ${error.message}</div>`;
            }
            
            document.getElementById('testResults').innerHTML = results;
        }

        function testEdgeCases() {
            updateWatermark();
            
            const testCases = [
                { name: 'ç©ºç§˜å¯†', text: 'æµ‹è¯•æ–‡æœ¬', secret: '' },
                { name: 'å¾ˆçŸ­çš„æ–‡æœ¬', text: 'ä½ å¥½', secret: 'ç§˜å¯†' },
                { name: 'å¾ˆé•¿çš„ç§˜å¯†', text: 'ç”¨äºé•¿ç§˜å¯†æµ‹è¯•çš„çŸ­æ–‡æœ¬', secret: 'è¿™æ˜¯ä¸€ä¸ªéå¸¸é•¿çš„ç§˜å¯†æ¶ˆæ¯ï¼Œå¯èƒ½æ¯”åŸå§‹æ–‡æœ¬æœ¬èº«è¿˜è¦é•¿ï¼' },
                { name: 'ç‰¹æ®Šå­—ç¬¦', text: 'åŒ…å«ç‰¹æ®Šå­—ç¬¦çš„æ–‡æœ¬: @#$%^&*()_+-=[]{}|;:,.<>?', secret: 'ç‰¹æ®Šå­—ç¬¦æµ‹è¯•ï¼' }
            ];
            
            let results = '<h3>è¾¹ç•Œæƒ…å†µæµ‹è¯•ç»“æœï¼š</h3>';
            
            testCases.forEach((testCase) => {
                try {
                    const watermarked = watermark.addWatermarkRandom(testCase.text, testCase.secret);
                    const extracted = watermark.extractAsString(watermarked);
                    const success = extracted === testCase.secret;
                    
                    results += `<div class="${success ? 'result' : 'error'}">
                        ${testCase.name}: ${success ? 'âœ…' : 'âŒ'}<br>
                        æ–‡æœ¬é•¿åº¦: ${testCase.text.length}, ç§˜å¯†é•¿åº¦: ${testCase.secret.length}<br>
                        ${success ? 'æˆåŠŸ' : `æœŸæœ›: "${testCase.secret}", å¾—åˆ°: "${extracted}"`}
                    </div>`;
                } catch (error) {
                    results += `<div class="error">${testCase.name}: âŒ é”™è¯¯: ${error.message}</div>`;
                }
            });
            
            document.getElementById('testResults').innerHTML = results;
        }

        function showResult(message) {
            document.getElementById('extractResult').innerHTML = `<div class="result">${message}</div>`;
            document.getElementById('extractResult').classList.remove('hidden');
        }

        function showError(message) {
            document.getElementById('extractResult').innerHTML = `<div class="error">${message}</div>`;
            document.getElementById('extractResult').classList.remove('hidden');
        }

        // ä½¿ç”¨é»˜è®¤æ°´å°åˆå§‹åŒ–
        updateWatermark();
    </script>
</body>
</html>